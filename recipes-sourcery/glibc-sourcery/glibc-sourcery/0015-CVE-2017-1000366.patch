From c095fc47b3be54f6b40422968d674066f07b61a4 Mon Sep 17 00:00:00 2001
From: Paul Carroll <pcarroll@mentor.com>
Date: Mon, 10 Jul 2017 10:25:30 -0700
Subject: [PATCH 15/16] 2017-07-10  Paul Carroll  <pcarroll@codesourcery.com>

	ITS-180
	* release-notes-csl.xml (GLIBC CVE fix): New note.

	Backport from upstream:

	2017-06-19  Florian Weimer  <fweimer@redhat.com>

	[BZ #21624]
	CVE-2017-1000366
	* elf/rtld.c (process_envvars): Ignore LD_LIBRARY_PATH for
	__libc_enable_secure.
---
 ChangeLog.csl         | 14 ++++++++++++++
 elf/rtld.c            |  3 ++-
 release-notes-csl.xml | 15 +++++++++++++++
 3 files changed, 31 insertions(+), 1 deletion(-)

diff --git a/ChangeLog.csl b/ChangeLog.csl
index eff3e8b..4675ec6 100644
--- a/ChangeLog.csl
+++ b/ChangeLog.csl
@@ -1,3 +1,17 @@
+2017-07-10  Paul Carroll  <pcarroll@codesourcery.com>
+
+	ITS-180
+	* release-notes-csl.xml (GLIBC CVE fix): New note.
+
+	Backport from upstream:
+
+	2017-06-19  Florian Weimer  <fweimer@redhat.com>
+
+	[BZ #21624]
+	CVE-2017-1000366
+	* elf/rtld.c (process_envvars): Ignore LD_LIBRARY_PATH for
+	__libc_enable_secure.
+
 2016-08-10  Joseph Myers  <joseph@codesourcery.com>
 
 	* release-notes-csl.xml (Linux kernel 3.2 or later required): New
diff --git a/elf/rtld.c b/elf/rtld.c
index a1b3a39..6149d7f 100644
--- a/elf/rtld.c
+++ b/elf/rtld.c
@@ -2439,7 +2439,8 @@ process_envvars (enum mode *modep)
 
 	case 12:
 	  /* The library search path.  */
-	  if (memcmp (envline, "LIBRARY_PATH", 12) == 0)
+	  if (!__libc_enable_secure
+	      && memcmp (envline, "LIBRARY_PATH", 12) == 0)
 	    {
 	      library_path = &envline[13];
 	      break;
diff --git a/release-notes-csl.xml b/release-notes-csl.xml
index b33ed3f..83ec9ba 100644
--- a/release-notes-csl.xml
+++ b/release-notes-csl.xml
@@ -5,6 +5,21 @@
      relevant; it may be removed if it is relevant to all targets.
  -->
 
+      <!-- UUID: eeeaf874-3d8a-4427-a70f-5c64a5dd3145 -->
+      <!-- TARGET: * -->
+      <!-- FEATURES: -->
+      <!-- COMPONENTS: glibc -->
+      <!-- SORT: glibc -->
+      <!-- ISSUE: ITS-180 -->
+      <formalpara>
+        <title>Glibc CVE-2017-1000366 <envar>LD_LIBRARY_PATH</envar> fix</title>
+        <para>
+          CVE-2017-1000366, where <envar>LD_LIBRARY_PATH</envar> could be
+	  used to cause a buffer overflow and escalate privilege in a
+	  secure environment, has been fixed.
+        </para>
+      </formalpara>
+
       <!-- UUID: 2cb5e43f-f852-4c25-8e0f-889ad8894059 -->
       <!-- TARGET: arm-none-linux-gnueabi powerpc-linux-gnu powerpc-lsi-linux-gnu -->
       <!-- SORT: glibc -->
-- 
2.8.1

